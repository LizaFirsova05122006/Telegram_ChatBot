<h1 align="center">Телеграм бот: <a href="https://t.me/Cup_of_Happiness_bot">Кофейня "Чашка Счастья"</a></h1>
<h2>Бот, который упростит работу любой кофейни!</h2>
<nav>
  <h2>Содержание</h2>
  <ol>
    <li><a href="#id1">Задачи, которые выполняет проект</a></li>
    <li><a href="#id2">Использованные технологии</a></li>
    <ul type="disc">
      <li><a href="#id2.1">Python</a></li>
      <li><a href="#id2.2">Aiogram</a></li>
      <li><a href="#id2.3">dotenv</a></li>
      <li><a href="#id2.4">SQLite</a></li>
      <li><a href="#id2.5">Асинхронное программирование(asyncio)</a></li>
      <li><a href="#id2.6">Webhooks</a></li>
      <li><a href="#id2.7">datetime</a></li>
      <li><a href="#id2.8">Thread</a></li>
      <li><a href="#id2.9">Flask</a></li>
    </ul>
    <li><a href="#id3">Техническое описание проекта</a></li>
    <li><a href="#id4">Обзор основных команд бота</a></li>
    <ul type="disc">
      <li><a href="#id4.1">Для администратора</a></li>
      <ul type="circle">
        <li><a href="#id4.1.1">Команда "/start"</a></li>
        <li><a href="#id4.1.2">Команда "Учет запасов"</a></li>
        <li><a href="#id4.1.3">Команда "Меню"</a></li>
        <li><a href="#id4.1.4">Команда "Сообщения пользователей"</a></li>
      </ul>
      <li><a href="#id4.2">Для бариста</a></li>
      <ul type="disc">
        <li><a href="#id4.2.1">Команда "Заказы"</a></li>
        <li><a href="#id4.2.2">Команда "Обучение"</a></li>
        <li><a href="#id4.2.3">Команда "Калькулятор"</a></li>
        <li><a href="#id4.2.4">Команда "Смена"</a></li>
      </ul>
      <li><a href="#id4.3">Для пользователей</a></li>
      <ul type="disc">
        <li><a href="#id4.3.1">Команда "Сделать заказ"</a></li>
        <li><a href="#id4.3.2">Команда "Меню"</a></li></h4>
        <li><a href="#id4.3.3">Команда "Программа лояльности"</a></li>
        <li><a href="#id4.3.4">Команда "Обратная связь"</a></li>
        <li><a href="#id4.3.5">Команда "Посмотреть историю заказов"</a></li>
      </ul>
    </ul>
    <li><a href="#id5">Хостинг бота</a></li>
    <li><a href="#id6">Что будет дальше?</a></li>
    <li><a href="#id7">Рекомендации по запуску кода</a></li>
  </ol>
</nav>
<br></br>
<h2 id="id1">Задачи, которые выполняет проект:</h2>
<ol type="1">
  <h3><li>Возможность заказать любимые позиции онлайн, не ождидая своей очереди в кофейне</li></h3>
  <h3><li>Возможность следить за расходом ингредиентов</li></h3>
</ol>
<br></br>
<h2 id="id2">Использованные технологии</h2>
<ol type="1">
  <h3 id="id2.1"><li>Python - основной язык программирования</li></h3>
  <h3 id="id2.2"><li>Aiogram - библиотека для работы с Telegram Bot Api. Она позволяет легко обрабатывать команды, сообщения и взаимодействовать с пользователем. Здесь используются следующие компоненты:</li></h3>
  <ul type="disc">
    <h3><li>Bot, Dispatcher - для создания и управления ботом</li></h3>
    <h3><li>types - для работа с типами данных, специфичными для Telgram</li></h3>
    <h3><li>Command - для создания фильтров команд</li></h3>
    <h3><li>InlineKeyboardBuilder - для построения встроенных клавиатур</li></h3>
    <h3><li>FSInputFile - класс, позволяющий загружать файлы из файловой системы для отправки в Telegram</li></h3>
    <h3><li>ParseMode - перечисление, содержащее режимы форматирования текста(например, HTML)</li></h3>
    <h3><li>MediaGroupBuilder - класс, предназначенный для группировки медиафайлов, которые могут быть отправлены в одном сообщении</li></h3>
  </ul>
  <h3 id="id2.3"><li>dotenv - библиотека, позволяющая загружать переменные окружения из файла .env</li></h3>
  <h3 id="id2.4"><li>SQLite - база данных, используемая для хранения информации</li></h3>
  <h3 id="id2.5"><li>Асинхронное программирование(asyncio) - позволяет обрабатывать несколько задач одновременно, что особенно важно для работы бота, чтобы он мог обрабатывать множество запросов пользователей в реальном времени</li></h3>
  <h3 id="id2.6"><li>Webhooks - используется для поддержания работы бота, чтобы он мог оставаться активным и получать новые сообщения</li></h3>
  <h3 id="id2.7"><li>datetime - модуль предоставляет классы для работы с датой и временем</li></h3>
  <h3 id="id2.8"><li>Thread - класс из модуля threading, который позволяет создавать потоки</li></h3>
  <h3 id="id2.9"><li>Flask - веб-фреймворк для создания веб-приложений на Python</li></h3>
</ol>
<br></br>
<h2 id="id3">Техническое описание проекта</h2>
<ol type="1">
  <h3><li>img - директория, содержащая:</li></h3>
  <ul type="disc">
    <h3><li>menu - директория для хранения меню</li></h3>
    <ul type="circle">
      <h3><li>1.jpg - фотография меню</li></h3>
    </ul>
  </ul>
  <h3><li>.env - файл, содержащий токен бота</li></h3>
  <h3><li>admin.py - файл, содержащий функции, осуществляющие функционал для администратора</li></h3>
  <h3><li>barista.py - файл, содержащий функции, осуществляющие функционал для бариста</li></h3>
  <h3><li>booklet.pdf - файл - памятка, которую бот отправляет бариста</li></h3>
  <h3><li>cafe.db - база данных</li></h3>
  <h3><li>logo.png - логотип кофейни</li></h3>
  <h3><li>main.py - главный файл проекта, который осуществляет работу бота</li></h3>
  <h3><li>month.py - файл, содержащий функции, осуществляющие функционал показа истории заказов за определенный месяц</li></h3>
  <h3><li>payment.py - файл, содержащий функции, осуществляющие функционал оплаты заказа</li></h3>
  <h3><li>requirements.txt - файл, содержащий список необходимых бибилиотек</li></h3>
  <h3><li>system_notifications.py - файл, содержащий функции, осуществляющие функционал системы</li></h3>
  <h3><li>users.py - файл, содержащий функции, осуществляющие функционал для пользователя</li></h3>
  <h3><li>web.py - файл, содержащий код, необходимый при хостинге бота (см. п. <a href="#id5">Хостинг бота</a>)</li></h3>
</ol>
<br></br>
<h2 id="id4">Обзор команд функций бота</h2>
<ol type="1">
  <h3 id="id4.1"><li>Для администратора</li></h3>
  <ul type="disc">
    <h3 id="id4.1.1"><li>Команда "/start" - привествует администратора, напоминает какие функции доступны</li></h3>
    <h3 id="id4.1.2"><li>Команда "Учет запасов" - выгружает из базы данных расход ингредиентов, а также дает рекомендации о том, какие ингредиенты необходимо заказать. Реализуется программой при помощи функции inventory_accounting()</li></h3>
    <h3 id="id4.1.3"><li>Команда "Меню" - позволяет просмотреть актуальное на данный момент меню. Реализуется программой при помощи функции menu_a()</li></h3>
    <h3 id="id4.1.4"><li>Команда "Сообщения пользователей" - позволяет просмотреть какие сообщения оставили пользователи, а также ответить на те, котоыре этого требуют. Реализуется программой следующими функциями:</li></h3>
      <ul type="circle">
        <h3><li>user_messages() - спрашивает, какие сообщения стоит показать</li></h3>
        <h3><li>regular_messages() - выводит сообщения, ответ администратора на которые не требуется</li></h3>
        <h3><li>awaiting_response() - выводит сообшение, на которые требуется ответ администратора</li></h3>
        <h3><li>admin_answer() - запрашивает номер сообщения, на который необходимо дать ответ</li></h3>
        <h3><li>messages() с глобальной переменной waiting_num - запрашивает ответ на сообщение пользователя</li></h3>
        <h3><li>messages() с глобальными переменными waiting_answers, id_answer - отправляет сообщение пользователю</li></h3>
      </ul>
  </ul>
  <h3  id="id4.2"><li>Для бариста</li></h3>
  <ul type="disc">
    <h3 id="id4.2.1"><li>Команда "Заказы" - позволяет просмотреть очередь заказов и взять в работу свободный. Реализуется программой следующими функциями:</li></h3>
      <ul type="circle">
        <h3><li>barista_orders() - выводит первый заказ, который еще не был приготовлен</li></h3>
        <h3><li>prepare() - отмечает в базе данных, что заказ взять на готовку</li></h3>
        <h3><li>ready_order() - отмечает в базе данных, что заказ готов и отправляет пользователю сообщение об этом</li></h3>
      </ul>
    <h3 id="id4.2.2"><li>Команда "Обучение" - позволяет бариста научится технологии приготовления кофе или освежить в памяти знания. Реализуется программой при помощи функции education()</li></h3>
    <h3 id="id4.2.3"><li>Команда "Калькулятор" - позволяет расчитать необходимое количество кофе. Реализуется программой при помощии функций:</li></h3>
    <ul type="circle">
      <h3><li>calculator() - запрашивает вес молотого кофе</li></h3>
      <h3><li>messages() с глобальной переменной coffe_int - выводит вес кофе в чашке</li></h3>
    </ul>
    <h3 id="id4.2.4"><li>Команда "Смена" - позволяет открыть/закрыть смену и получить информацию о прошедшем дне. Реализуется программой при помощи функций:</li></h3>
    <ul type="circle">
      <h3><li>open_a_shift() - проверяет открыта ли смена или можно уже закрыть</li></h3>
      <h3><li>made_open() - позволяет открыть смену, а также уведомляет пользователей, кто хотел заказать кофе до открытия смены</li></h3>
      <h3><li>close_shift() - позволяет закрыть смену, а также вывоит итоги дня</li></h3>
    </ul>
  </ul>
  <h3 id="id4.3"><li>Для пользователя:</li></h3>
  <ul type="disc">
    <h3 id="id4.3.1"><li>Команда "Сделать заказ" - позволяет сделать заказ онлайн, вне зависимости от того, где находится человек: в кофейне или нет. Реализуется программой при помощи функций:</li></h3>
    <ul type="circle">
      <h3><li>made_order() - проверяет время, в которое пользователь обратился. Если время до 9:00, то программа запомнит пользователя, и как только смена будет открыта - уведомит его об этом. Если время после 20:30, то заказ не будет принят, т.к. его не успеют приготовить. А также если время 9:00-20:30 - выведет меню, и спросит хотел бы пользователь что-то заказать</li></h3>
      <h3><li>order_selection() - проверит наличие ингредиентов и предоставит пользователю список напитков, которые можно заказать</li></h3>
      <h3><li>Функции espresso(), cappuccino(), latte(), flat_white(), mokko(), bumble() - запрашивают количество (существует ограниение - не более 5 напитков одного вида)</li></h3>
      <h3><li>messages() с глобальной переменной waiting_count - добавит выбор пользователя в заказ и спросит хотел бы пользователь что-то заказать. Если да - вернется к функции order_selection. Если нет - перейдет к оплате</li></h3>
      <h3><li>user_online_pay() - функция, которая будет доработана (см. п. <a href="#id6">Что будет дальше?</a>). Пока эта функция имитирует успешную оплату: собирает в словарь заказ, добавляет запись в базу данных, проверяет на возможность воспользоваться программой лояльности</li></h3>
    </ul>
    <h3 id="id4.3.2"><li>Команда "Меню" - позволяет просмотреть актуальное меню и сделать заказ. Реализуется программой при помощи функции menu()</li></h3>
    <h3 id="id4.3.3"><li>Команда "Программа лояльности" - выгодные условия для постоянных клиентов. Реализуется прграммой при помощи функции loyalty_program()</li></h3>
    <h3 id="id4.3.4"><li>Команда "Обратная связь" - позволяет оставить свое сообщение, а также запросить ответ администратора. Реализуется программой при помощи функций:</li></h3>
    <ul type="circle">
      <h3><li>feedback() - запрашивает сообщение</li></h3>
      <h3><li>messages() с глобальной переменной waiting_text - спрашивает требуется ли ответ администратора</li></h3>
      <h3><li>send_answer_no() - если ответ не требуется, то бот благодарит за сообщение</li></h3>
      <h3><li>send_answer_yes() - если ответ требуется, то бот также благодарит за сообщение и отправляет смс-уведомление администратору</li></h3>
    </ul>
    <h3 id="id4.3.5"><li>Команда "Посмотреть историю заказов" - позволяет посмотреть, что пользователь заказывал до этого. Реализуется программой при помощи функций:</li></h3>
    <ul type="circle">
      <h3><li>view_the_history_order() - спрашивает за какой(ие) месяц(ы) показать историю</li></h3>
      <h3><li>jan(), feb(), mar(), apr(), mayy(), jun(), jul(), aug(), sep(), oct(), nov(), dec() - функции, отвечающие за показ истории заказов по месяцам в зависимости от того, когда пользователь делал заказы</li></h3>
    </ul>
  </ul>
</ol>
<br></br>
<h2 id="id5">Хостинг бота</h2>
<h3>Для того, чтобы бот работал постоянно и был доступен в любое время, необходимо разместить его на хостинге. Это обеспечит его непрерывную работу и возможность взаимодействия с администраторами, бариста и пользователями 24/7.</h3>
<ol type="1">
  <h3><li>Проект был импортирован из репозитория на <a href="https://github.com/">GitHub</a> в <a href="https://replit.com/">Replit</a></li></h3>
  <h3><li>Затем выполняется запуск проекта(настраивается локальная среда)</li></h3>
  <h3><li>Код программы из файла web.py:</li></h3>
  <ul type="disc">
    <h3><li>Создает экземпляр приложения Flask</li></h3>
    <h3><li>Определяется маршрут (endpint) для корневого URL('/')</li></h3>
    <h3><li>Функция run() запускает Flask сервер</li></h3>
    <h3><li>Функция keep_alive() создает новый поток и запускает его, передавая функции run() в качестве целевой</li></h3>
  </ul>
  <h3>Таким образом, Flask-сервер будет работать в фоновом режиме. Если к боту долгое время никто не обращается, то программа может "уснуть"</h3>
  <h3><li>Поэтому, для мониторинга работы используется <a href="https://uptimerobot.com/">UptimeRobot</a>, который отправляет запросы на Flask-сервер и не дает боту "уснуть"</li></h3>
  <h3>Но возникает проблема бесплатной версии аккаунта: необходимо проверять работоспособность часто.</h3>
</ol>
<br></br>
<h2 id="id6">Что будет дальше?</h2>
<h3>При интеграции с настоящей кофейней планируется:</h3>
<ol type="1">
  <h3><li>Подключить систему онлайн оплаты</li></h3>
  <h3><li>Реализовать возможность собирать статистику по заказам для расширения программы лояльности</li></h3>
  <h3><li>Реализовать возможность анализировать обраную свзяь пользователей и разработать раздел FAQ</li></h3>
  <h3><li>Приобрести платный аккаунт хостинга для работы без перебоев, чтобы это не повлияло на работу бота</li></h3>
</ol>
<br></br>
<h2 id="id7">Рекомендации по запуску кода</h2>
<ol type="1">
  <h3><li>Убедитесь, что у Вас установлен Git. Проверить можно, выполнив программу:</li></h3>
  <pre><code>git --version</code></pre>
  <h3>Если Git не установлен, скачайте и установите его с официального сайта</h3>
  <h3><li>Откройте терминал или командную строку</li></h3>
  <h3><li>Перейдите в папку, куда Вы хотите клоинровать репозиторий, с помощию команды cd:</li></h3>
  <pre><code>cd путь/к/Вашей/папке</code></pre>
  <h3><li>Используйте следующую команду, чтобы клоинровать репозиторий:</li></h3>
  <pre><code>git clone https://github.com/LizaFirsova05122006/Telegram_ChatBot.git</code></pre>
  <h3><li>Получите токен у <a https://t.me/BotFather>BotFather</a></li></h3>
  <h3><li>Вставьте полученный токен в файл .env вместо "YOUR_TOKEN"</li></h3>
  <h3><li>Откройте IDE с интерпретатором Python и запустите main.py</li></h3>
  <h3><li>Или в командной строке (в папке, куда был склонирован репозиторий) введите команду:</li></h3>
  <pre><code>python main.py</code></pre>
</ol>
